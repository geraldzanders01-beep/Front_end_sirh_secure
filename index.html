<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Candidature | CORP-HR</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f8fafc; color: #1e293b; }
        .input-field { @apply w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl outline-none focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 transition-all; }
        .btn-primary { @apply w-full bg-blue-600 text-white py-5 rounded-2xl font-bold text-lg hover:bg-blue-700 shadow-lg shadow-blue-200 active:scale-[0.98] transition-all; }
    </style>
</head>
<body class="py-10 px-4">

    <div class="max-w-3xl mx-auto">
        
        <!-- HEADER -->
        <div class="flex items-center justify-between mb-8">
            <div class="flex items-center gap-3">
                <div class="w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center text-white shadow-lg">
                    <i class="fa-solid fa-paper-plane text-xl"></i>
                </div>
                <div>
                    <h1 class="text-2xl font-extrabold tracking-tight text-slate-900">Postuler</h1>
                    <p class="text-sm text-slate-500 font-medium">Rejoignez CORP-HR en quelques clics</p>
                </div>
            </div>
            <span class="text-[10px] font-black text-slate-300 uppercase tracking-widest">Secure Portal</span>
        </div>

        <!-- FORMULAIRE -->
        <form id="applyForm" onsubmit="handleApply(event)" class="bg-white rounded-[2.5rem] border border-slate-100 shadow-xl overflow-hidden">
            <div class="p-8 md:p-12 space-y-10">
                
                <!-- SECTION 1 : INFOS PERSO -->
                <div class="space-y-6">
                    <h2 class="text-xs font-black uppercase text-blue-600 tracking-widest flex items-center gap-2">
                        <i class="fa-solid fa-user-circle"></i> Informations Personnelles
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                        <div class="space-y-2">
                            <label class="text-[11px] font-bold text-slate-500 ml-1">NOM ET PRÉNOM</label>
                            <input type="text" name="nom_complet" placeholder="Ex: Jean Dupont" required class="w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl outline-none focus:border-blue-500 transition-all">
                        </div>
                        <div class="space-y-2">
                            <label class="text-[11px] font-bold text-slate-500 ml-1">E-MAIL</label>
                            <input type="email" name="email" placeholder="nom@exemple.com" required class="w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl outline-none focus:border-blue-500 transition-all">
                        </div>
                        <div class="space-y-2">
                            <label class="text-[11px] font-bold text-slate-500 ml-1">TÉLÉPHONE</label>
                            <input type="tel" name="telephone" placeholder="+229 ..." required class="w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl outline-none focus:border-blue-500 transition-all">
                        </div>
                        <div id="field-dob" class="space-y-2">
                            <label class="text-[11px] font-bold text-slate-500 ml-1">DATE DE NAISSANCE</label>
                            <input type="date" name="date_naissance" class="w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl outline-none focus:border-blue-500 transition-all">
                        </div>
                    </div>
                </div>

                <!-- SECTION 2 : POSTE -->
                <div class="space-y-6">
                    <h2 class="text-xs font-black uppercase text-blue-600 tracking-widest flex items-center gap-2">
                        <i class="fa-solid fa-briefcase"></i> Votre Candidature
                    </h2>
                    <div class="space-y-2">
                        <label class="text-[11px] font-bold text-slate-500 ml-1">POSTE VISÉ</label>
                        <select name="poste_vise" class="w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl outline-none appearance-none font-semibold text-slate-700 cursor-pointer focus:border-blue-500">
                            <option>DEVELOPPEUR FULLSTACK</option>
                            <option>AGENT DE SÉCURITÉ</option>
                            <option>RESPONSABLE RH</option>
                            <option>COMPTABLE</option>
                        </select>
                    </div>
                </div>

                <!-- SECTION 3 : FICHIERS -->
                <div class="space-y-6">
                    <h2 class="text-xs font-black uppercase text-blue-600 tracking-widest flex items-center gap-2">
                        <i class="fa-solid fa-paperclip"></i> Documents justificatifs (Max 5Mo)
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="relative group">
                            <input type="file" name="cv" id="cv" class="hidden" onchange="validateFile(this)" required>
                            <label for="cv" class="flex flex-col items-center justify-center p-6 border-2 border-dashed border-slate-200 rounded-2xl cursor-pointer hover:bg-blue-50 transition-all h-full text-center">
                                <i class="fa-solid fa-file-pdf text-slate-300 text-xl mb-2"></i>
                                <span class="text-[10px] font-bold text-slate-500">CV (Obligatoire)</span>
                                <span id="label-cv" class="text-[9px] text-blue-600 font-bold mt-1 truncate w-full px-2"></span>
                            </label>
                        </div>
                        <div id="field-dip" class="relative group">
                            <input type="file" name="diploma" id="diploma" class="hidden" onchange="validateFile(this)">
                            <label for="diploma" class="flex flex-col items-center justify-center p-6 border-2 border-dashed border-slate-200 rounded-2xl cursor-pointer hover:bg-slate-50 transition-all h-full text-center">
                                <i class="fa-solid fa-graduation-cap text-slate-300 text-xl mb-2"></i>
                                <span class="text-[10px] font-bold text-slate-500">Diplômes / Attestations</span>
                                <span id="label-diploma" class="text-[9px] text-slate-600 font-bold mt-1 truncate w-full px-2"></span>
                            </label>
                        </div>
                        <div id="field-lm" class="relative group">
                            <input type="file" name="lm" id="lm" class="hidden" onchange="validateFile(this)">
                            <label for="lm" class="flex flex-col items-center justify-center p-6 border-2 border-dashed border-slate-200 rounded-2xl cursor-pointer hover:bg-slate-50 transition-all h-full text-center">
                                <i class="fa-solid fa-envelope-open-text text-slate-300 text-xl mb-2"></i>
                                <span class="text-[10px] font-bold text-slate-500">Lettre de Motivation</span>
                                <span id="label-lm" class="text-[9px] text-blue-600 font-bold mt-1 truncate w-full px-2"></span>
                            </label>
                        </div>
                        <div id="field-id" class="relative group">
                            <input type="file" name="id_card" id="id_card" class="hidden" onchange="validateFile(this)">
                            <label for="id_card" class="flex flex-col items-center justify-center p-6 border-2 border-dashed border-slate-200 rounded-2xl cursor-pointer hover:bg-slate-50 transition-all h-full text-center">
                                <i class="fa-solid fa-id-card text-slate-300 text-xl mb-2"></i>
                                <span class="text-[10px] font-bold text-slate-500">Pièce Identité</span>
                                <span id="label-id_card" class="text-[9px] text-blue-600 font-bold mt-1 truncate w-full px-2"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <button type="submit" id="btnSubmit" class="w-full bg-blue-600 text-white py-5 rounded-2xl font-bold text-lg hover:bg-blue-700 shadow-xl shadow-blue-200 transition-all flex items-center justify-center gap-3">
                    Soumettre ma candidature <i class="fa-solid fa-arrow-right"></i>
                </button>
            </div>
        </form>

        <!-- FOOTER & CONFIG DISCRET -->
        <div class="mt-8 flex justify-between items-center px-4">
            <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">© 2026 CORP-HR Group</p>
            <!-- BOUTON ADMIN -->
            <button id="btn-admin-settings" onclick="document.getElementById('configPanel').classList.remove('hidden')" class="text-slate-300 hover:text-slate-600 transition-colors">
                <i class="fa-solid fa-gear text-lg"></i>
            </button>
        </div>
    </div>

    <!-- PANEL CONFIGURATION (MODAL) -->
    <div id="configPanel" class="fixed inset-0 bg-slate-900/80 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-[2rem] p-10 max-w-sm w-full shadow-2xl">
            <h2 class="font-black text-xl mb-6 text-slate-800 tracking-tight text-center">Lien de Partage</h2>
            <div class="space-y-4 mb-8">
                <label class="flex items-center justify-between p-4 bg-slate-50 rounded-2xl cursor-pointer border border-slate-100">
                    <span class="text-sm font-bold text-slate-600">Masquer Naissance</span>
                    <input type="checkbox" id="check-dob" class="w-5 h-5 accent-blue-600">
                </label>
                <label class="flex items-center justify-between p-4 bg-slate-50 rounded-2xl cursor-pointer border border-slate-100">
                    <span class="text-sm font-bold text-slate-600">Masquer Lettre Motiv</span>
                    <input type="checkbox" id="check-lm" class="w-5 h-5 accent-blue-600">
                </label>
                <label class="flex items-center justify-between p-4 bg-slate-50 rounded-2xl cursor-pointer border border-slate-100">
                    <span class="text-sm font-bold text-slate-600">Masquer Diplômes</span>
                    <input type="checkbox" id="check-dip" class="w-5 h-5 accent-blue-600">
                </label>
                <label class="flex items-center justify-between p-4 bg-slate-50 rounded-2xl cursor-pointer border border-slate-100">
                    <span class="text-sm font-bold text-slate-600">Masquer Pièce ID</span>
                    <input type="checkbox" id="check-id" class="w-5 h-5 accent-blue-600">
                </label>
            </div>
            <button onclick="copyConfiguredLink()" class="w-full py-4 bg-blue-600 text-white rounded-2xl font-bold shadow-lg mb-3">Générer & Copier le lien</button>
            <button onclick="document.getElementById('configPanel').classList.add('hidden')" class="w-full text-slate-400 font-bold text-xs uppercase text-center mt-2">Annuler</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        const API_URL = "https://sirh-secure-backend.onrender.com/api/ingest-candidate";

        // 1. SECURITÉ : MASQUER L'ADMIN SI LE LIEN EST PARTAGÉ
        window.onload = () => {
            const params = new URLSearchParams(window.location.search);
            
            // Si le paramètre 'shared' est présent, on détruit littéralement le bouton Admin
            if (params.has('shared')) {
                const adminBtn = document.getElementById('btn-admin-settings');
                if(adminBtn) adminBtn.remove(); // On ne fait pas juste le masquer, on le retire du code
            }

            // Application des masques
            if (params.get('hdob') === '1') document.getElementById('field-dob').classList.add('hidden');
            if (params.get('hlm') === '1') document.getElementById('field-lm').classList.add('hidden');
            if (params.get('hdip') === '1') document.getElementById('field-dip').classList.add('hidden');
            if (params.get('hid') === '1') document.getElementById('field-id').classList.add('hidden');
        };

        // 2. GÉNÉRATION DU LIEN AVEC PARAMETRE 'SHARED' OBLIGATOIRE
        function copyConfiguredLink() {
            const hDob = document.getElementById('check-dob').checked ? '1' : '0';
            const hLm = document.getElementById('check-lm').checked ? '1' : '0';
            const hDip = document.getElementById('check-dip').checked ? '1' : '0';
            const hId = document.getElementById('check-id').checked ? '1' : '0';
            
            const baseUrl = window.location.origin + window.location.pathname;
            
            // On ajoute TOUJOURS shared=1 pour désactiver le bouton admin chez le candidat
            const finalUrl = `${baseUrl}?shared=1&hdob=${hDob}&hlm=${hLm}&hdip=${hDip}&hid=${hId}`;
            
            navigator.clipboard.writeText(finalUrl).then(() => {
                Swal.fire({ 
                    icon: 'success', 
                    title: 'Lien Candidat prêt !', 
                    text: 'Le bouton réglages est désormais désactivé pour ce lien.', 
                    confirmButtonColor: '#2563eb' 
                });
                document.getElementById('configPanel').classList.add('hidden');
            });
        }

        function validateFile(input) {
            const file = input.files[0];
            if (file && file.size > 5 * 1024 * 1024) {
                Swal.fire({ icon: 'warning', title: 'Fichier trop lourd', text: 'Limite de 5 Mo.' });
                input.value = ""; updateLabel(input); return;
            }
            updateLabel(input);
        }

        function updateLabel(input) {
            const label = document.getElementById('label-' + input.id);
            if (input.files.length > 0) {
                label.innerText = input.files[0].name;
                input.parentElement.querySelector('label').classList.add('border-blue-500', 'bg-blue-50');
            } else {
                label.innerText = "";
                input.parentElement.querySelector('label').classList.remove('border-blue-500', 'bg-blue-50');
            }
        }

        async function handleApply(e) {
            e.preventDefault();
            const btn = document.getElementById('btnSubmit');
            btn.disabled = true;
            btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin mr-2"></i> Transmission...';

            try {
                const response = await fetch(API_URL, { method: 'POST', body: new FormData(e.target) });
                if (response.ok) {
                    Swal.fire({ icon: 'success', title: 'Candidature reçue', confirmButtonColor: '#2563eb' });
                    e.target.reset();
                    document.querySelectorAll('[id^="label-"]').forEach(el => el.innerText = "");
                    document.querySelectorAll('label').forEach(el => el.classList.remove('border-blue-500', 'bg-blue-50'));
                } else { throw new Error(); }
            } catch (err) {
                Swal.fire({ icon: 'error', title: 'Erreur technique' });
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'Soumettre ma candidature <i class="fa-solid fa-arrow-right"></i>';
            }
        }
    </script>
</body>
</html>


